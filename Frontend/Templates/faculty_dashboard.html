<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>üë®‚Äçüè´ Faculty Portal</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="{{ url_for('faculty_dashboard') }}" class="nav-item active">
                    <span>üìä</span> Dashboard
                </a>
                <a href="{{ url_for('add_marks') }}" class="nav-item">
                    <span>‚ûï</span> Add Marks
                </a>
                <a href="{{ url_for('logout') }}" class="nav-item">
                    <span>üö™</span> Logout
                </a>
            </nav>
            <div class="sidebar-footer">
                <p>Logged in as:<br><strong>{{ session.user_name }}</strong></p>
            </div>
        </aside>

        <main class="main-content">
            <header class="dashboard-header">
                <h1>Faculty Dashboard</h1>
                <p>Review and process student complaints</p>
            </header>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>{{ complaints|length }}</h3>
                    <p>Total Complaints</p>
                </div>
                <div class="stat-card stat-warning">
                    <h3>{{ complaints|selectattr('status', 'equalto', 'Pending Review')|list|length }}</h3>
                    <p>Pending Review</p>
                </div>
                <div class="stat-card stat-success">
                    <h3>{{ complaints|selectattr('status', 'equalto', 'Approved')|list|length }}</h3>
                    <p>Approved</p>
                </div>
                <div class="stat-card stat-danger">
                    <h3>{{ complaints|selectattr('status', 'equalto', 'Rejected')|list|length }}</h3>
                    <p>Rejected</p>
                </div>
            </div>

            <div class="content-section">
                <h2>All Complaints</h2>

                {% if complaints %}
                    <div class="complaints-list">
                        {% for complaint in complaints %}
                        <div class="complaint-card">
                            <div class="complaint-header">
                                <div>
                                    <h3>Complaint #{{ complaint.id }} - {{ complaint.subject }}</h3>
                                    <p class="complaint-meta">
                                        Student: {{ complaint.student_name }} ({{ complaint.student_email }}) | 
                                        Exam: {{ complaint.exam }} | 
                                        Date: {{ complaint.created_at[:10] }}
                                    </p>
                                </div>
                                <span class="badge badge-{{ 'success' if complaint.status == 'Approved' else 'warning' if complaint.status == 'Pending Review' else 'danger' }}">
                                    {{ complaint.status }}
                                </span>
                            </div>

                            <div class="complaint-body">
                                <div class="ai-summary">
                                    <strong>ü§ñ AI Analysis:</strong>
                                    {% if complaint.ai_issue_type %}
                                    <p><strong>Issue Type:</strong> 
                                        <span class="badge 
                                            {% if complaint.ai_issue_type == 'Marks Discrepancy' %}badge-marks-discrepancy
                                            {% elif complaint.ai_issue_type == 'Calculation Error' %}badge-calculation-error
                                            {% elif complaint.ai_issue_type == 'Unchecked Question' %}badge-unchecked
                                            {% elif complaint.ai_issue_type == 'Evaluation Issue' %}badge-evaluation
                                            {% else %}badge-info{% endif %}">
                                            {{ complaint.ai_issue_type }}
                                        </span>
                                    </p>
                                    {% endif %}
                                    <p>{{ complaint.ai_summary }}</p>
                                    <span class="badge badge-info">{{ complaint.extracted_question }}</span>
                                    {% if complaint.ai_confidence_score %}
                                    <span class="confidence-score" style="margin-left: 10px;">
                                        {{ (complaint.ai_confidence_score * 100)|round(1) }}% Confidence
                                    </span>
                                    {% endif %}
                                </div>

                                <div class="complaint-text">
                                    <strong>Student's Complaint:</strong>
                                    <p>{{ complaint.complaint_text }}</p>
                                </div>

                                {% if complaint.faculty_remark %}
                                <div class="faculty-remark">
                                    <strong>Faculty Remark:</strong>
                                    <p>{{ complaint.faculty_remark }}</p>
                                </div>
                                {% endif %}
                            </div>

                            <div class="complaint-actions">
                                <a href="{{ url_for('review_complaint', complaint_id=complaint.id) }}" class="btn btn-primary">
                                    Review & Update
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>üìù No complaints to review</p>
                    </div>
                {% endif %}
            </div>
        </main>
    </div>
</body>
</html>
